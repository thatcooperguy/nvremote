import { NextResponse } from 'next/server';

const mockSessions = [
  {
    id: 'sess_01',
    name: 'Gaming Session #12',
    host: '192.168.1.100',
    status: 'active',
    transport: 'udp',
    quality: 'balanced',
    codec: 'H.265',
    latency: 11,
    jitter: 1.2,
    packetLoss: 0.01,
    bitrate: 82000,
    fps: 144,
    resolution: '2560x1440',
    duration: '2h 34m',
    relay: false,
    token: 'cs_Kx9mT4vQ8nR2wL5pJ7yB3hF6dA0sG1',
    createdAt: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
  },
  {
    id: 'sess_02',
    name: 'Dev Testing',
    host: '10.0.0.50',
    status: 'active',
    transport: 'udp',
    quality: 'competitive',
    codec: 'H.264',
    latency: 8,
    jitter: 0.8,
    packetLoss: 0.0,
    bitrate: 50000,
    fps: 240,
    resolution: '1920x1080',
    duration: '45m',
    relay: false,
    token: 'cs_Pn3rY7wK1mX6vB9qT2hL4jD8fA5sE0',
    createdAt: new Date(Date.now() - 45 * 60 * 1000).toISOString(),
  },
  {
    id: 'sess_03',
    name: 'Movie Night',
    host: '192.168.1.100',
    status: 'ended',
    transport: 'udp',
    quality: 'cinematic',
    codec: 'H.265',
    latency: 15,
    jitter: 2.1,
    packetLoss: 0.02,
    bitrate: 150000,
    fps: 60,
    resolution: '3840x2160',
    duration: '3h 12m',
    relay: false,
    token: 'cs_Wq8mN5vR3kX7yB1pJ9hF4dA6sG2tL0',
    createdAt: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),
  },
  {
    id: 'sess_04',
    name: 'Remote Work Stream',
    host: '172.16.0.10',
    status: 'ended',
    transport: 'tcp',
    quality: 'balanced',
    codec: 'H.264',
    latency: 22,
    jitter: 3.5,
    packetLoss: 0.05,
    bitrate: 60000,
    fps: 60,
    resolution: '1920x1080',
    duration: '6h 45m',
    relay: true,
    token: 'cs_Rt4mL8vK2nX5yB7pJ3hF9dA1sG6wE0',
    createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
  },
  {
    id: 'sess_05',
    name: 'LAN Party',
    host: '192.168.1.105',
    status: 'ended',
    transport: 'udp',
    quality: 'competitive',
    codec: 'H.264',
    latency: 5,
    jitter: 0.4,
    packetLoss: 0.0,
    bitrate: 50000,
    fps: 240,
    resolution: '1920x1080',
    duration: '4h 20m',
    relay: false,
    token: 'cs_Gx7mQ1vN4kX8yB2pJ6hF0dA9sG3wT5',
    createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
  },
];

export async function GET() {
  return NextResponse.json({
    sessions: mockSessions,
    total: mockSessions.length,
    active: mockSessions.filter((s) => s.status === 'active').length,
  });
}

export async function POST(request: Request) {
  const body = await request.json();
  const newSession = {
    id: `sess_${Date.now()}`,
    name: body.name || 'New Session',
    host: body.host || '127.0.0.1',
    status: 'connecting',
    transport: body.transport || 'udp',
    quality: body.quality || 'balanced',
    codec: body.quality === 'cinematic' ? 'H.265' : 'H.264',
    latency: 0,
    jitter: 0,
    packetLoss: 0,
    bitrate: 0,
    fps: 0,
    resolution: body.quality === 'cinematic' ? '3840x2160' : body.quality === 'competitive' ? '1920x1080' : '2560x1440',
    duration: '0m',
    relay: body.relay || false,
    token: `cs_${Array.from({ length: 32 }, () => 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'[Math.floor(Math.random() * 62)]).join('')}`,
    sessionUrl: `https://nvremote.com/s/${Math.random().toString(36).slice(2, 10)}`,
    createdAt: new Date().toISOString(),
  };

  return NextResponse.json(newSession, { status: 201 });
}
