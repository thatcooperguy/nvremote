appId: com.nvremote.client
productName: NVRemote
copyright: Copyright (c) NVRemote
electronVersion: 33.3.1

# Prevent electron-builder from running its own npm install during packaging.
# In npm workspace setups, this step restructures node_modules and deletes
# app-builder-bin, causing spawn ENOENT failures.
npmRebuild: false

directories:
  output: release

files:
  - dist-electron/**/*
  - dist/**/*
  - "!node_modules/**/*"

win:
  target:
    - target: nsis
      arch:
        - x64
  artifactName: "NVRemote-${version}-Setup.${ext}"
  publisherName: NVRemote
  # Code signing: electron-builder auto-signs when CSC_LINK and
  # CSC_KEY_PASSWORD env vars are set. No config needed here â€”
  # just ensure the secrets exist in GitHub Actions.

nsis:
  oneClick: false
  perMachine: true
  allowToChangeInstallationDirectory: true
  deleteAppDataOnUninstall: false
  createDesktopShortcut: true
  createStartMenuShortcut: true
  shortcutName: NVRemote

linux:
  target:
    - target: AppImage
      arch:
        - x64
    - target: deb
      arch:
        - x64
    - target: tar.gz
      arch:
        - x64
  artifactName: "NVRemote-${version}-x86_64.${ext}"
  category: Game
  desktop:
    StartupWMClass: NVRemote

deb:
  afterInstall: build/linux/after-install.sh
  depends:
    - libgtk-3-0
    - libnotify4
    - libnss3
    - libxss1
    - libxtst6
    - xdg-utils
    - libatspi2.0-0
    - libuuid1
    - libsecret-1-0

mac:
  target:
    - target: dmg
      arch:
        - universal
  artifactName: "NVRemote-${version}-universal.${ext}"
  category: public.app-category.games
  # Enable Hardened Runtime (required for notarization)
  hardenedRuntime: true
  gatekeeperAssess: false
  entitlements: build/entitlements.mac.plist
  entitlementsInherit: build/entitlements.mac.plist
  # Notarize after signing (requires APPLE_ID, APPLE_APP_SPECIFIC_PASSWORD, APPLE_TEAM_ID)
  notarize: false
  # afterSign: build/notarize.cjs  # Requires electron-builder v25+
  # Allow shared native resources in universal builds (FFmpeg dylibs,
  # N-API addons are arch-specific but bundled from a single CI build)
  x64ArchFiles: "Contents/Resources/resources/**"

dmg:
  title: "NVRemote ${version}"

protocols:
  name: NVRemote Protocol
  schemes:
    - nvremote

extraResources:
  - from: resources/
    to: resources/
    filter:
      - "**/*"

publish:
  provider: github
  owner: thatcooperguy
  repo: nvremote
